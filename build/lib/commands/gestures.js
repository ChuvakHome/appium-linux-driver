"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

require("source-map-support/register");

var _support = require("@appium/support");

var _baseDriver = require("@appium/base-driver");

var _xpath = _interopRequireDefault(require("xpath.js"));

var _xmldom = require("xmldom");

var _privateapis = _interopRequireDefault(require("@stdspa/stdspalinux_temp/dist/privateapis"));

var _utils = require("../utils");

const commands = {};

function extractUuid(options = {}, keyNames = ['element-6066-11e4-a52e-4f735466cecf', 'element']) {
  for (const name of keyNames) {
    if (options[name]) {
      const result = _support.util.unwrapElement(options[name]);

      if (result) {
        return result;
      }
    }
  }

  return null;
}

function requireUuid(options = {}, keyNames = ['element-6066-11e4-a52e-4f735466cecf', 'element']) {
  const result = extractUuid(options, keyNames);

  if (!result) {
    throw new _baseDriver.errors.InvalidArgumentError(`${keyNames[0]} field is mandatory`);
  }

  return result;
}

commands._findElRect = function (uuid) {
  var _attrs$find;

  const strEl = this._cache.get(uuid);

  const doc = new _xmldom.DOMParser().parseFromString(strEl);

  if (!doc.attributes) {
    throw new _baseDriver.errors.UnknownError("the element has no rect attribute");
  }

  const attrs = Array.from(doc.attributes);
  const rect = (_attrs$find = attrs.find(p => p.name = 'rect')) === null || _attrs$find === void 0 ? void 0 : _attrs$find.value;

  if (!rect) {
    throw new _baseDriver.errors.UnknownError("the element has no rect attribute");
  }

  const mat = /^\[(?<x>\d+)\,(?<y>\d+)\,(?<width>\d+)\,(?<height>\d+)\]$/.exec(rect);

  if (!mat) {
    throw new _baseDriver.errors.UnknownError("the element's rect attribute is malformed");
  }

  const {
    x,
    y,
    width,
    height
  } = mat.groups;
  return {
    x: Number.parseInt(x),
    y: Number.parseInt(y),
    width: Number.parseInt(width),
    height: Number.parseInt(height)
  };
};

commands.setValue = async function setValue(opts = {}) {
  const uuid = requireUuid(opts);
  const {
    value,
    text
  } = opts;

  const _v = _support.util.hasValue(value) ? value : _support.util.hasValue(text) ? text : null;

  const {
    x,
    y,
    width,
    height
  } = this._findElRect(uuid);

  const _x = x + width / 2;

  const _y = y + height / 2;

  await (0, _utils.wait4sec)(0.5);

  _privateapis.default.mouse_click(_x, _y, 1);

  await (0, _utils.wait4sec)(0.5);

  _privateapis.default.keyboard_typeStringCopyPaste(_v);

  return null;
};

commands.setValueImmediate = async function setValueImmediate(opts = {}) {
  const uuid = requireUuid(opts);
  const {
    value,
    text
  } = opts;

  const _v = _support.util.hasValue(value) ? value : _support.util.hasValue(text) ? text : null;

  const {
    x,
    y,
    width,
    height
  } = this._findElRect(uuid);

  const _x = x + width / 2;

  const _y = y + height / 2;

  await (0, _utils.wait4sec)(0.5);

  _privateapis.default.mouse_click(_x, _y, 1);

  await (0, _utils.wait4sec)(0.5);

  _privateapis.default.keyboard_typeStringCopyPaste(_v);

  return null;
};

commands.click = async function click(opts = {}) {
  const uuid = extractUuid(opts);
  const {
    x,
    y,
    keyModifierFlags
  } = opts;
  return null;
};

commands.scroll = async function scroll(opts = {}) {
  const uuid = extractUuid(opts);
  const {
    x,
    y,
    deltaX,
    deltaY,
    keyModifierFlags
  } = opts;
  return null;
};

commands.swipe = async function swipe(opts = {}) {
  const uuid = extractUuid(opts);
  const {
    x,
    y,
    direction,
    velocity,
    keyModifierFlags
  } = opts;
  return null;
};

commands.rightClick = async function rightClick(opts = {}) {
  const uuid = extractUuid(opts);
  const {
    x,
    y,
    keyModifierFlags
  } = opts;
  return null;
};

commands.hover = async function hover(opts = {}) {
  const uuid = extractUuid(opts);
  const {
    x,
    y,
    keyModifierFlags
  } = opts;
  return null;
};

commands.doubleClick = async function doubleClick(opts = {}) {
  const uuid = extractUuid(opts);
  const {
    x,
    y,
    keyModifierFlags
  } = opts;
  return null;
};

commands.keys = async function keys(opts = {}) {
  const uuid = extractUuid(opts);
  const {
    keys
  } = opts;
  return null;
};

commands.pressKeyCode = async function pressKeyCode(opts = {}) {
  const uuid = extractUuid(opts);
  const {
    keycode,
    flags
  } = opts;
  return null;
};

commands.longPressKeyCode = async function longPressKeyCode(opts = {}) {
  const uuid = extractUuid(opts);
  const {
    keycode,
    flags
  } = opts;
  return null;
};

var _default = commands;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9jb21tYW5kcy9nZXN0dXJlcy5qcyJdLCJuYW1lcyI6WyJjb21tYW5kcyIsImV4dHJhY3RVdWlkIiwib3B0aW9ucyIsImtleU5hbWVzIiwibmFtZSIsInJlc3VsdCIsInV0aWwiLCJ1bndyYXBFbGVtZW50IiwicmVxdWlyZVV1aWQiLCJlcnJvcnMiLCJJbnZhbGlkQXJndW1lbnRFcnJvciIsIl9maW5kRWxSZWN0IiwidXVpZCIsInN0ckVsIiwiX2NhY2hlIiwiZ2V0IiwiZG9jIiwiZG9tIiwicGFyc2VGcm9tU3RyaW5nIiwiYXR0cmlidXRlcyIsIlVua25vd25FcnJvciIsImF0dHJzIiwiQXJyYXkiLCJmcm9tIiwicmVjdCIsImZpbmQiLCJwIiwidmFsdWUiLCJtYXQiLCJleGVjIiwieCIsInkiLCJ3aWR0aCIsImhlaWdodCIsImdyb3VwcyIsIk51bWJlciIsInBhcnNlSW50Iiwic2V0VmFsdWUiLCJvcHRzIiwidGV4dCIsIl92IiwiaGFzVmFsdWUiLCJfeCIsIl95IiwiYXBpcyIsIm1vdXNlX2NsaWNrIiwia2V5Ym9hcmRfdHlwZVN0cmluZ0NvcHlQYXN0ZSIsInNldFZhbHVlSW1tZWRpYXRlIiwiY2xpY2siLCJrZXlNb2RpZmllckZsYWdzIiwic2Nyb2xsIiwiZGVsdGFYIiwiZGVsdGFZIiwic3dpcGUiLCJkaXJlY3Rpb24iLCJ2ZWxvY2l0eSIsInJpZ2h0Q2xpY2siLCJob3ZlciIsImRvdWJsZUNsaWNrIiwia2V5cyIsInByZXNzS2V5Q29kZSIsImtleWNvZGUiLCJmbGFncyIsImxvbmdQcmVzc0tleUNvZGUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBRUEsTUFBTUEsUUFBUSxHQUFHLEVBQWpCOztBQUVBLFNBQVNDLFdBQVQsQ0FBc0JDLE9BQU8sR0FBRyxFQUFoQyxFQUFvQ0MsUUFBUSxHQUFHLENBQUMscUNBQUQsRUFBd0MsU0FBeEMsQ0FBL0MsRUFBbUc7QUFDakcsT0FB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QixJQUFJLEdBQUdYLFdBQVcsQ0FBQ3FDLElBQUQsQ0FBeEI7QUFDQSxRQUFNO0FBQUV1QixJQUFBQSxPQUFGO0FBQVdDLElBQUFBO0FBQVgsTUFBcUJ4QixJQUEzQjtBQUNBLFNBQU8sSUFBUDtBQUNELENBSkQ7O0FBTUF0QyxRQUFRLENBQUMrRCxnQkFBVCxHQUE0QixlQUFlQSxnQkFBZixDQUFpQ3pCLElBQUksR0FBRyxFQUF4QyxFQUE0QztBQUN0RSxRQUFNMUIsSUFBSSxHQUFHWCxXQUFXLENBQUNxQyxJQUFELENBQXhCO0FBQ0EsUUFBTTtBQUFFdUIsSUFBQUEsT0FBRjtBQUFXQyxJQUFBQTtBQUFYLE1BQXFCeEIsSUFBM0I7QUFDQSxTQUFPLElBQVA7QUFDRCxDQUpEOztlQU1ldEMsUSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHV0aWwgfSBmcm9tICdAYXBwaXVtL3N1cHBvcnQnO1xuaW1wb3J0IHsgZXJyb3JzIH0gZnJvbSAnQGFwcGl1bS9iYXNlLWRyaXZlcic7XG5pbXBvcnQgc2VsZWN0IGZyb20gJ3hwYXRoLmpzJztcbmltcG9ydCB7IERPTVBhcnNlciBhcyBkb20gfSBmcm9tICd4bWxkb20nO1xuaW1wb3J0IGFwaXMgZnJvbSAnQHN0ZHNwYS9zdGRzcGFsaW51eF90ZW1wL2Rpc3QvcHJpdmF0ZWFwaXMnO1xuaW1wb3J0IHsgd2FpdDRzZWMgfSBmcm9tICcuLi91dGlscyc7XG5cbmNvbnN0IGNvbW1hbmRzID0ge307XG5cbmZ1bmN0aW9uIGV4dHJhY3RVdWlkIChvcHRpb25zID0ge30sIGtleU5hbWVzID0gWydlbGVtZW50LTYwNjYtMTFlNC1hNTJlLTRmNzM1NDY2Y2VjZicsICdlbGVtZW50J10pIHtcbiAgZm9yIChjb25zdCBuYW1lIG9mIGtleU5hbWVzKSB7XG4gICAgaWYgKG9wdGlvbnNbbmFtZV0pIHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IHV0aWwudW53cmFwRWxlbWVudChvcHRpb25zW25hbWVdKTtcbiAgICAgIGlmIChyZXN1bHQpIHtcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmV0dXJuIG51bGw7XG59XG5cbmZ1bmN0aW9uIHJlcXVpcmVVdWlkIChvcHRpb25zID0ge30sIGtleU5hbWVzID0gWydlbGVtZW50LTYwNjYtMTFlNC1hNTJlLTRmNzM1NDY2Y2VjZicsICdlbGVtZW50J10pIHtcbiAgY29uc3QgcmVzdWx0ID0gZXh0cmFjdFV1aWQob3B0aW9ucywga2V5TmFtZXMpO1xuICBpZiAoIXJlc3VsdCkge1xuICAgIHRocm93IG5ldyBlcnJvcnMuSW52YWxpZEFyZ3VtZW50RXJyb3IoYCR7a2V5TmFtZXNbMF19IGZpZWxkIGlzIG1hbmRhdG9yeWApO1xuICB9XG4gIHJldHVybiByZXN1bHQ7XG59XG5cbmNvbW1hbmRzLl9maW5kRWxSZWN0ID0gZnVuY3Rpb24odXVpZCkge1xuICBjb25zdCBzdHJFbCA9IHRoaXMuX2NhY2hlLmdldCh1dWlkKTtcbiAgY29uc3QgZG9jID0gbmV3IGRvbSgpLnBhcnNlRnJvbVN0cmluZyhzdHJFbCk7XG4gIGlmICghZG9jLmF0dHJpYnV0ZXMpIHtcbiAgICB0aHJvdyBuZXcgZXJyb3JzLlVua25vd25FcnJvcihcInRoZSBlbGVtZW50IGhhcyBubyByZWN0IGF0dHJpYnV0ZVwiKTtcbiAgfVxuICBjb25zdCBhdHRycyA9IEFycmF5LmZyb20oZG9jLmF0dHJpYnV0ZXMpO1xuICBjb25zdCByZWN0ID0gYXR0cnMuZmluZChwID0+IHAubmFtZSA9ICdyZWN0Jyk/LnZhbHVlO1xuICBpZiAoIXJlY3QpIHtcbiAgICB0aHJvdyBuZXcgZXJyb3JzLlVua25vd25FcnJvcihcInRoZSBlbGVtZW50IGhhcyBubyByZWN0IGF0dHJpYnV0ZVwiKTtcbiAgfVxuICBjb25zdCBtYXQgPSAvXlxcWyg/PHg+XFxkKylcXCwoPzx5PlxcZCspXFwsKD88d2lkdGg+XFxkKylcXCwoPzxoZWlnaHQ+XFxkKylcXF0kLy5leGVjKHJlY3QpXG4gIGlmICghbWF0KSB7XG4gICAgdGhyb3cgbmV3IGVycm9ycy5Vbmtub3duRXJyb3IoXCJ0aGUgZWxlbWVudCdzIHJlY3QgYXR0cmlidXRlIGlzIG1hbGZvcm1lZFwiKTtcbiAgfVxuICBjb25zdCB7eCwgeSwgd2lkdGgsIGhlaWdodH0gPSBtYXQuZ3JvdXBzO1xuICByZXR1cm4ge1xuICAgIHg6IE51bWJlci5wYXJzZUludCh4KSxcbiAgICB5OiBOdW1iZXIucGFyc2VJbnQoeSksXG4gICAgd2lkdGg6IE51bWJlci5wYXJzZUludCh3aWR0aCksXG4gICAgaGVpZ2h0OiBOdW1iZXIucGFyc2VJbnQoaGVpZ2h0KVxuICB9O1xufTtcblxuY29tbWFuZHMuc2V0VmFsdWUgPSBhc3luYyBmdW5jdGlvbiBzZXRWYWx1ZSAob3B0cyA9IHt9KSB7XG4gIGNvbnN0IHV1aWQgPSByZXF1aXJlVXVpZChvcHRzKTtcbiAgY29uc3QgeyB2YWx1ZSwgdGV4dCB9ID0gb3B0cztcbiAgY29uc3QgX3YgPSB1dGlsLmhhc1ZhbHVlKHZhbHVlKT8gdmFsdWU6IHV0aWwuaGFzVmFsdWUodGV4dCk/IHRleHQ6IG51bGw7XG4gIGNvbnN0IHt4LCB5LCB3aWR0aCwgaGVpZ2h0fSA9IHRoaXMuX2ZpbmRFbFJlY3QodXVpZCk7XG4gIGNvbnN0IF94ID0geCArIHdpZHRoIC8gMjtcbiAgY29uc3QgX3kgPSB5ICsgaGVpZ2h0IC8gMjtcbiAgYXdhaXQgd2FpdDRzZWMoMC41KTtcbiAgYXBpcy5tb3VzZV9jbGljayhfeCwgX3ksIDEpO1xuICBhd2FpdCB3YWl0NHNlYygwLjUpO1xuICBhcGlzLmtleWJvYXJkX3R5cGVTdHJpbmdDb3B5UGFzdGUoX3YpO1xuICByZXR1cm4gbnVsbDtcbn07XG5cbmNvbW1hbmRzLnNldFZhbHVlSW1tZWRpYXRlID0gYXN5bmMgZnVuY3Rpb24gc2V0VmFsdWVJbW1lZGlhdGUob3B0cyA9IHt9KSB7XG4gIGNvbnN0IHV1aWQgPSByZXF1aXJlVXVpZChvcHRzKTtcbiAgY29uc3QgeyB2YWx1ZSwgdGV4dCB9ID0gb3B0cztcbiAgY29uc3QgX3YgPSB1dGlsLmhhc1ZhbHVlKHZhbHVlKT8gdmFsdWU6IHV0aWwuaGFzVmFsdWUodGV4dCk/IHRleHQ6IG51bGw7XG4gIGNvbnN0IHt4LCB5LCB3aWR0aCwgaGVpZ2h0fSA9IHRoaXMuX2ZpbmRFbFJlY3QodXVpZCk7XG4gIGNvbnN0IF94ID0geCArIHdpZHRoIC8gMjtcbiAgY29uc3QgX3kgPSB5ICsgaGVpZ2h0IC8gMjtcbiAgYXdhaXQgd2FpdDRzZWMoMC41KTtcbiAgYXBpcy5tb3VzZV9jbGljayhfeCwgX3ksIDEpO1xuICBhd2FpdCB3YWl0NHNlYygwLjUpO1xuICBhcGlzLmtleWJvYXJkX3R5cGVTdHJpbmdDb3B5UGFzdGUoX3YpO1xuICByZXR1cm4gbnVsbDtcbn07XG5cbmNvbW1hbmRzLmNsaWNrID0gYXN5bmMgZnVuY3Rpb24gY2xpY2sgKG9wdHMgPSB7fSkge1xuICBjb25zdCB1dWlkID0gZXh0cmFjdFV1aWQob3B0cyk7XG4gIGNvbnN0IHsgeCwgeSwga2V5TW9kaWZpZXJGbGFncyB9ID0gb3B0cztcbiAgcmV0dXJuIG51bGw7XG59O1xuXG5jb21tYW5kcy5zY3JvbGwgPSBhc3luYyBmdW5jdGlvbiBzY3JvbGwgKG9wdHMgPSB7fSkge1xuICBjb25zdCB1dWlkID0gZXh0cmFjdFV1aWQob3B0cyk7XG4gIGNvbnN0IHtcbiAgICB4LCB5LFxuICAgIGRlbHRhWCwgZGVsdGFZLFxuICAgIGtleU1vZGlmaWVyRmxhZ3MsXG4gIH0gPSBvcHRzO1xuICByZXR1cm4gbnVsbDtcbn07XG5cbmNvbW1hbmRzLnN3aXBlID0gYXN5bmMgZnVuY3Rpb24gc3dpcGUgKG9wdHMgPSB7fSkge1xuICBjb25zdCB1dWlkID0gZXh0cmFjdFV1aWQob3B0cyk7XG4gIGNvbnN0IHtcbiAgICB4LCB5LFxuICAgIGRpcmVjdGlvbixcbiAgICB2ZWxvY2l0eSxcbiAgICBrZXlNb2RpZmllckZsYWdzLFxuICB9ID0gb3B0cztcbiAgcmV0dXJuIG51bGw7XG59O1xuXG5jb21tYW5kcy5yaWdodENsaWNrID0gYXN5bmMgZnVuY3Rpb24gcmlnaHRDbGljayAob3B0cyA9IHt9KSB7XG4gIGNvbnN0IHV1aWQgPSBleHRyYWN0VXVpZChvcHRzKTtcbiAgY29uc3QgeyB4LCB5LCBrZXlNb2RpZmllckZsYWdzIH0gPSBvcHRzO1xuICByZXR1cm4gbnVsbDtcbn07XG5cbmNvbW1hbmRzLmhvdmVyID0gYXN5bmMgZnVuY3Rpb24gaG92ZXIgKG9wdHMgPSB7fSkge1xuICBjb25zdCB1dWlkID0gZXh0cmFjdFV1aWQob3B0cyk7XG4gIGNvbnN0IHsgeCwgeSwga2V5TW9kaWZpZXJGbGFncyB9ID0gb3B0cztcbiAgcmV0dXJuIG51bGw7XG59O1xuXG5jb21tYW5kcy5kb3VibGVDbGljayA9IGFzeW5jIGZ1bmN0aW9uIGRvdWJsZUNsaWNrIChvcHRzID0ge30pIHtcbiAgY29uc3QgdXVpZCA9IGV4dHJhY3RVdWlkKG9wdHMpO1xuICBjb25zdCB7IHgsIHksIGtleU1vZGlmaWVyRmxhZ3MgfSA9IG9wdHM7XG4gIHJldHVybiBudWxsO1xufTtcblxuY29tbWFuZHMua2V5cyA9IGFzeW5jIGZ1bmN0aW9uIGtleXMgKG9wdHMgPSB7fSkge1xuICBjb25zdCB1dWlkID0gZXh0cmFjdFV1aWQob3B0cyk7XG4gIGNvbnN0IHsga2V5cyB9ID0gb3B0cztcbiAgcmV0dXJuIG51bGw7XG59O1xuXG5jb21tYW5kcy5wcmVzc0tleUNvZGUgPSBhc3luYyBmdW5jdGlvbiBwcmVzc0tleUNvZGUgKG9wdHMgPSB7fSkge1xuICBjb25zdCB1dWlkID0gZXh0cmFjdFV1aWQob3B0cyk7XG4gIGNvbnN0IHsga2V5Y29kZSwgZmxhZ3MgfSA9IG9wdHM7XG4gIHJldHVybiBudWxsO1xufVxuXG5jb21tYW5kcy5sb25nUHJlc3NLZXlDb2RlID0gYXN5bmMgZnVuY3Rpb24gbG9uZ1ByZXNzS2V5Q29kZSAob3B0cyA9IHt9KSB7XG4gIGNvbnN0IHV1aWQgPSBleHRyYWN0VXVpZChvcHRzKTtcbiAgY29uc3QgeyBrZXljb2RlLCBmbGFncyB9ID0gb3B0cztcbiAgcmV0dXJuIG51bGw7XG59XG5cbmV4cG9ydCBkZWZhdWx0IGNvbW1hbmRzO1xuIl0sImZpbGUiOiJsaWIvY29tbWFuZHMvZ2VzdHVyZXMuanMiLCJzb3VyY2VSb290IjoiLi4vLi4vLi4ifQ==
