"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

require("source-map-support/register");

var _privateapis = _interopRequireDefault(require("@stdspa/stdspalinux_temp/dist/privateapis"));

var _xpath = _interopRequireDefault(require("xpath.js"));

var _xmldom = require("xmldom");

var _baseDriver = require("@appium/base-driver");

const commands = {};

commands.getWindowHandle = function getWindowHandle() {
  var _this$_win;

  return (_this$_win = this._win) === null || _this$_win === void 0 ? void 0 : _this$_win.wid;
};

commands.getWindowHandles = function getWindowHandles() {
  const appName = this.appName;

  const pids = _privateapis.default.app_running(appName);

  if (!pids || pids.length === 0) {
    throw new _baseDriver.errors.NoSuchWindowError(`application ${appName} is not running`);
  }

  const winHierachy = _privateapis.default.app_getWindowHierachy();

  const doc = new _xmldom.DOMParser().parseFromString(winHierachy);
  let xpath = pids.map(pid => `@pid="${pid}"`).join(' or ');
  xpath = `//*[${xpath} and @InputOutput="true"]`;
  const nodes = (0, _xpath.default)(doc, xpath);

  if (!nodes || nodes.length === 0) {
    return [];
  }

  let _nodes = [];

  for (const node of nodes) {
    if (!node.attributes) {
      continue;
    }

    const _node = {};
    const attrs = Array.from(node.attributes);

    for (const attr of attrs) {
      if (attr.name === 'class') {
        _node.class = attr.value.split(' ');
      } else if (attr.name === 'name') {
        _node.name = attr.value;
      } else if (attr.name === 'pid') {
        _node.pid = Number.parseInt(attr.value, 10);
      } else if (attr.name === 'wid') {
        _node.wid = Number.parseInt(attr.value, 10);
      }
    }

    _nodes.push(_node);
  }

  _nodes = _nodes.filter(p => (p.class || p.name) && p.pid && p.wid);

  if (_nodes.length === 0) {
    return [];
  }

  _nodes = _nodes.map(p => {
    let _node = {
      pid: p.pid,
      wid: p.wid,
      names: []
    };

    if (p.name) {
      _node.names.push(p.name);
    }

    if (p.class) {
      _node.names.push(...p.class);
    }

    return _node;
  });
  const wids = [];

  for (const _node of _nodes) {
    let ok = false;

    for (const name of _node.names) {
      if (_privateapis.default.a11y_checkWindowExists(name, _node.pid)) {
        ok = true;
        break;
      }
    }

    if (ok) {
      wids.push(_node.wid);
    }
  }

  return wids;
};

commands._getWinAndPid_FromWinName = function (windowName) {
  const pids = _privateapis.default.app_running(this.appName);

  if (!pids || pids.length === 0) {
    throw new _baseDriver.errors.NoSuchWindowError(`application ${this.appName} is not running`);
  }

  const winHierachy = _privateapis.default.app_getWindowHierachy();

  const doc = new _xmldom.DOMParser().parseFromString(winHierachy);
  let xpath = pids.map(pid => `@pid="${pid}"`).join(' or ');
  xpath = `//*[(${xpath}) and @InputOutput="true" and (@name="${windowName}" or contains(concat(" ", @class, " "), "${' ' + windowName + ' '}"))]`;
  const nodes = (0, _xpath.default)(doc, xpath);

  if (!nodes || nodes.length === 0) {
    throw new _baseDriver.errors.NoSuchWindowError(`the window ${windowName} doesn't present`);
  }

  let _nodes = [];

  for (const node of nodes) {
    if (!node.attributes) {
      continue;
    }

    const attrs = Array.from(node.attributes);
    const _node = {};

    for (const attr of attrs) {
      _node[attr.name] = attr.value;
    }

    _nodes.push(_node);
  }

  _nodes = _nodes.filter(p => (p.name || p.class) && p.pid && p.wid);

  if (_nodes.length === 0) {
    throw new _baseDriver.errors.NoSuchWindowError(`the window ${windowName} doesn't present`);
  }

  _nodes.sort((a, b) => {
    const av = a.name === windowName ? -1 : 1;
    const bv = b.name === windowName ? -1 : 1;
    return av - bv;
  });

  for (const _node of _nodes) {
    const _pid = Number.parseInt(_node.pid, 10);

    if (_privateapis.default.a11y_checkWindowExists(windowName, _pid)) {
      return {
        pid: _pid,
        wid: Number.parseInt(_node.wid, 10),
        name: windowName
      };
    }
  }

  throw new _baseDriver.errors.NoSuchWindowError(`the window ${windowName} doesn't present`);
};

commands._getWinAndPid_FromWinId = function (wid) {
  const winHierachy = _privateapis.default.app_getWindowHierachy();

  const doc = new _xmldom.DOMParser().parseFromString(winHierachy);
  const xpath = `//*[@wid="${wid}" and @InputOutput="true"]`;
  const nodes = (0, _xpath.default)(doc, xpath);

  if (!nodes || nodes.length === 0) {
    throw new _baseDriver.errors.NoSuchWindowError(`the window wid=${wid} doesn't present`);
  }

  let node = nodes[0];
  const attrs = Array.from(node.attributes);
  const _node = {};

  for (const attr of attrs) {
    _node[attr.name] = attr.value;
  }

  node = _node;

  if (!node.name || !node.pid || !node.wid) {
    throw new _baseDriver.errors.NoSuchWindowError(`the window wid=${wid} doesn't present`);
  }

  if (!_privateapis.default.a11y_checkWindowExists(node.name, Number.parseInt(node.pid, 10))) {
    throw new _baseDriver.errors.NoSuchWindowError(`the window wid=${wid} doesn't present`);
  }

  return {
    pid: Number.parseInt(node.pid, 10),
    wid: Number.parseInt(node.wid, 10),
    name: node.name
  };
};

function validateName(name) {
  if (!name) {
    return name;
  }

  for (let i = 0; i < name.length; ++i) {
    if (name[i] < '0' || name[i] > '9') {
      return name;
    }
  }

  return null;
}

function validateHandle(handle) {
  if (!handle) {
    return handle;
  }

  for (let i = 0; i < handle.length; ++i) {
    if (handle[i] < '0' || handle[i] > '9') {
      return null;
    }
  }

  return handle;
}

commands.setWindow = function setWindow(name, handle) {
  handle = validateHandle(handle);
  name = validateName(name);

  if (name) {
    const win = this._getWinAndPid_FromWinName(name);

    this._win = win;
  } else if (handle) {
    const win = this._getWinAndPid_FromWinId(handle);

    this._win = win;
  } else {
    throw new _baseDriver.errors.UnknownError("setWindow both name and handle don't have a value");
  }
};

commands.getWindowRect = function getWindowRect() {
  const win = this._win;

  if (!win) {
    throw new _baseDriver.errors.NoSuchWindowError(`window is not specified`);
  }

  const {
    wid
  } = win;
  return _privateapis.default.app_getWinRect(wid);
};

var _default = commands;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9jb21tYW5kcy93aW5kb3cuanMiXSwibmFtZXMiOlsiY29tbWFuZHMiLCJnZXRXaW5kb3dIYW5kbGUiLCJfd2luIiwid2lkIiwiZ2V0V2luZG93SGFuZGxlcyIsImFwcE5hbWUiLCJwaWRzIiwiYXBpcyIsImFwcF9ydW5uaW5nIiwibGVuZ3RoIiwiZXJyb3JzIiwiTm9TdWNoV2luZG93RXJyb3IiLCJ3aW5IaWVyYWNoeSIsImFwcF9nZXRXaW5kb3dIaWVyYWNoeSIsImRvYyIsImRvbSIsInBhcnNlRnJvbVN0cmluZyIsInhwYXRoIiwibWFwIiwicGlkIiwiam9pbiIsIm5vZGVzIiwiX25vZGVzIiwibm9kZSIsImF0dHJpYnV0ZXMiLCJfbm9kZSIsImF0dHJzIiwiQXJyYXkiLCJmcm9tIiwiYXR0ciIsIm5hbWUiLCJjbGFzcyIsInZhbHVlIiwic3BsaXQiLCJOdW1iZXIiLCJwYXJzZUludCIsInB1c2giLCJmaWx0ZXIiLCJwIiwibmFtZXMiLCJ3aWRzIiwib2siLCJhMTF5X2NoZWNrV2luZG93RXhpc3RzIiwiX2dldFdpbkFuZFBpZF9Gcm9tV2luTmFtZSIsIndpbmRvd05hbWUiLCJzb3J0IiwiYSIsImIiLCJhdiIsImJ2IiwiX3BpZCIsIl9nZXRXaW5BbmRQaWRfRnJvbVdpbklkIiwidmFsaWRhdGVOYW1lIiwiaSIsInZhbGlkYXRlSGFuZGxlIiwiaGFuZGxlIiwic2V0V2luZG93Iiwid2luIiwiVW5rbm93bkVycm9yIiwiZ2V0V2luZG93UmVjdCIsImFwcF9nZXRXaW5SZWN0Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUVBLE1BQU1BLFFBQVEsR0FBRyxFQUFqQjs7QUFFQUEsUUFBUSxDQUFDQyxlQUFULEdBQTJCLFNBQVNBLGVBQVQsR0FBNEI7QUFBQTs7QUFDckQsdUJBQU8sS0FBS0MsSUFBWiwrQ0FBTyxXQUFXQyxHQUFsQjtBQUNELENBRkQ7O0FBSUFILFFBQVEsQ0FBQ0ksZ0JBQVQsR0FBNEIsU0FBU0EsZ0JBQVQsR0FBNkI7QUFDdkQsUUFBTUMsT0FBTyxHQUFHLEtBQUtBLE9BQXJCOztBQUNBLFFBQU1DLElBQUksR0FBR0MscUJBQUtDLFdBQUwsQ0FBaUJILE9BQWpCLENBQWI7O0FBQ0EsTUFBSSxDQUFDQyxJQUFELElBQVNBLElBQUksQ0FBQ0csTUFBTCxLQUFnQixDQUE3QixFQUFnQztBQUM5QixVQUFNLElBQUlDLG1CQUFPQyxpQkFBWCxDQUE4QixlQUFjTixPQUFRLGlCQUFwRCxDQUFOO0FBQ0Q7O0FBQ0QsUUFBTU8sV0FBVyxHQUFHTCxxQkFBS00scUJBQUwsRUFBcEI7O0FBQ0EsUUFBTUMsR0FBRyxHQUFHLElBQUlDLGlCQUFKLEdBQVVDLGVBQVYsQ0FBMEJKLFdBQTFCLENBQVo7QUFDQSxNQUFJSyxLQUFLLEdBQUdYLElBQUksQ0FBQ1ksR0FBTCxDQUFVQyxHQUFELElBQVUsU0FBUUEsR0FBSSxHQUEvQixFQUFtQ0MsSUFBbkMsQ0FBd0MsTUFBeEMsQ0FBWjtBQUNBSCxFQUFBQSxLQUFLLEdBQUksT0FBTUEsS0FBTSwyQkFBckI7QUFDQSxRQUFNSSxLQUFLLEdBQUcsb0JBQU9QLEdBQVAsRUFBWUcsS0FBWixDQUFkOztBQUNBLE1BQUksQ0FBQ0ksS0FBRCxJQUFVQSxLQUFLLENBQUNaLE1BQU4sS0FBaUIsQ0FBL0IsRUFBa0M7QUFDaEMsV0FBTyxFQUFQO0FBQ0Q7O0FBQ0QsTUFBSWEsTUFBTSxHQUFHLEVBQWI7O0FBQ0EsT0FBSyxNQUFNQyxJQUFYLElBQW1CRixLQUFuQixFQUEwQjtBQUN4QixRQUFJLENBQUNFLElBQUksQ0FBQ0MsVUFBVixFQUFzQjtBQUNwQjtBQUNEOztBQUNELFVBQU1DLEtBQUssR0FBRyxFQUFkO0FBQ0EsVUFBTUMsS0FBSyxHQUFHQyxLQUFLLENBQUNDLElBQU4sQ0FBV0wsSUFBSSxDQUFDQyxVQUFoQixDQUFkOztBQUNBLFNBQUssTUFBTUssSUFBWCxJQUFtQkgsS0FBbkIsRUFBMEI7QUFDeEIsVUFBSUcsSUFBSSxDQUFDQyxJQUFMLEtBQWMsT0FBbEIsRUFBMkI7QUFDekJMLFFBQUFBLEtBQUssQ0FBQ00sS0FBTixHQUFjRixJQUFJLENBQUNHLEtBQUwsQ0FBV0MsS0FBWCxDQUFpQixHQUFqQixDQUFkO0FBQ0QsT0FGRCxNQUVPLElBQUlKLElBQUksQ0FBQ0MsSUFBTCxLQUFjLE1BQWxCLEVBQTBCO0FBQy9CTCxRQUFBQSxLQUFLLENBQUNLLElBQU4sR0FBYUQsSUFBSSxDQUFDRyxLQUFsQjtBQUNELE9BRk0sTUFFQSxJQUFJSCxJQUFJLENBQUNDLElBQUwsS0FBYyxLQUFsQixFQUF5QjtBQUM5QkwsUUFBQUEsS0FBSyxDQUFDTixHQUFOLEdBQVllLE1BQU0sQ0FBQ0MsUUFBUCxDQUFnQk4sSUFBSSxDQUFDRyxLQUFyQixFQUE0QixFQUE1QixDQUFaO0FBQ0QsT0FGTSxNQUVBLElBQUlILElBQUksQ0FBQ0MsSUFBTCxLQUFjLEtBQWxCLEVBQXlCO0FBQzlCTCxRQUFBQSxLQUFLLENBQUN0QixHQUFOLEdBQVkrQixNQUFNLENBQUNDLFFBQVAsQ0FBZ0JOLElBQUksQ0FBQ0csS0FBckIsRUFBNEIsRUFBNUIsQ0FBWjtBQUNEO0FBQ0Y7O0FBQ0RWLElBQUFBLE1BQU0sQ0FBQ2MsSUFBUCxDQUFZWCxLQUFaO0FBQ0Q7O0FBQ0RILEVBQUFBLE1BQU0sR0FBR0EsTUFBTSxDQUFDZSxNQUFQLENBQWVDLENBQUQsSUFBTyxDQUFDQSxDQUFDLENBQUNQLEtBQUYsSUFBV08sQ0FBQyxDQUFDUixJQUFkLEtBQXVCUSxDQUFDLENBQUNuQixHQUF6QixJQUFnQ21CLENBQUMsQ0FBQ25DLEdBQXZELENBQVQ7O0FBQ0EsTUFBSW1CLE1BQU0sQ0FBQ2IsTUFBUCxLQUFrQixDQUF0QixFQUF5QjtBQUN2QixXQUFPLEVBQVA7QUFDRDs7QUFDRGEsRUFBQUEsTUFBTSxHQUFHQSxNQUFNLENBQUNKLEdBQVAsQ0FBWW9CLENBQUQsSUFBTztBQUN6QixRQUFJYixLQUFLLEdBQUc7QUFBQ04sTUFBQUEsR0FBRyxFQUFFbUIsQ0FBQyxDQUFDbkIsR0FBUjtBQUFhaEIsTUFBQUEsR0FBRyxFQUFFbUMsQ0FBQyxDQUFDbkMsR0FBcEI7QUFBeUJvQyxNQUFBQSxLQUFLLEVBQUU7QUFBaEMsS0FBWjs7QUFDQSxRQUFJRCxDQUFDLENBQUNSLElBQU4sRUFBWTtBQUNWTCxNQUFBQSxLQUFLLENBQUNjLEtBQU4sQ0FBWUgsSUFBWixDQUFpQkUsQ0FBQyxDQUFDUixJQUFuQjtBQUNEOztBQUNELFFBQUlRLENBQUMsQ0FBQ1AsS0FBTixFQUFhO0FBQ1hOLE1BQUFBLEtBQUssQ0FBQ2MsS0FBTixDQUFZSCxJQUFaLENBQWlCLEdBQUdFLENBQUMsQ0FBQ1AsS0FBdEI7QUFDRDs7QUFDRCxXQUFPTixLQUFQO0FBQ0QsR0FUUSxDQUFUO0FBVUEsUUFBTWUsSUFBSSxHQUFHLEVBQWI7O0FBQ0EsT0FBSyxNQUFNZixLQUFYLElBQW9CSCxNQUFwQixFQUE0QjtBQUMxQixRQUFJbUIsRUFBRSxHQUFHLEtBQVQ7O0FBQ0EsU0FBSyxNQUFNWCxJQUFYLElBQW1CTCxLQUFLLENBQUNjLEtBQXpCLEVBQWdDO0FBQzlCLFVBQUloQyxxQkFBS21DLHNCQUFMLENBQTRCWixJQUE1QixFQUFrQ0wsS0FBSyxDQUFDTixHQUF4QyxDQUFKLEVBQWtEO0FBQ2hEc0IsUUFBQUEsRUFBRSxHQUFHLElBQUw7QUFDQTtBQUNEO0FBQ0Y7O0FBQ0QsUUFBSUEsRUFBSixFQUFRO0FBQ05ELE1BQUFBLElBQUksQ0FBQ0osSUFBTCxDQUFVWCxLQUFLLENBQUN0QixHQUFoQjtBQUNEO0FBQ0Y7O0FBQ0QsU0FBT3FDLElBQVA7QUFDRCxDQTlERDs7QUFnRUF4QyxRQUFRLENBQUMyQyx5QkFBVCxHQUFxQyxVQUFVQyxVQUFWLEVBQXNCO0FBQ3pELFFBQU10QyxJQUFJLEdBQUdDLHFCQUFLQyxXQUFMLENBQWlCLEtBQUtILE9BQXRCLENBQWI7O0FBQ0EsTUFBSSxDQUFDQyxJQUFELElBQVNBLElBQUksQ0FBQ0csTUFBTCxLQUFnQixDQUE3QixFQUFnQztBQUM5QixVQUFNLElBQUlDLG1CQUFPQyxpQkFBWCxDQUE4QixlQUFjLEtBQUtOLE9BQVEsaUJBQXpELENBQU47QUFDRDs7QUFDRCxRQUFNTyxXQUFXLEdBQUdMLHFCQUFLTSxxQkFBTCxFQUFwQjs7QUFDQSxRQUFNQyxHQUFHLEdBQUcsSUFBSUMsaUJBQUosR0FBVUMsZUFBVixDQUEwQkosV0FBMUIsQ0FBWjtBQUNBLE1BQUlLLEtBQUssR0FBR1gsSUFBSSxDQUFDWSxHQUFMLENBQVVDLEdBQUQsSUFBVSxTQUFRQSxHQUFJLEdBQS9CLEVBQW1DQyxJQUFuQyxDQUF3QyxNQUF4QyxDQUFaO0FBQ0FILEVBQUFBLEtBQUssR0FBSSxRQUFPQSxLQUFNLHlDQUF3QzJCLFVBQVcsNENBQTJDLE1BQU1BLFVBQU4sR0FBbUIsR0FBSSxNQUEzSTtBQUNBLFFBQU12QixLQUFLLEdBQUcsb0JBQU9QLEdBQVAsRUFBWUcsS0FBWixDQUFkOztBQUNBLE1BQUksQ0FBQ0ksS0FBRCxJQUFVQSxLQUFLLENBQUNaLE1BQU4sS0FBaUIsQ0FBL0IsRUFBa0M7QUFDaEMsVUFBTSxJQUFJQyxtQkFBT0MsaUJBQVgsQ0FBOEIsY0FBYWlDLFVBQVcsa0JBQXRELENBQU47QUFDRDs7QUFDRCxNQUFJdEIsTUFBTSxHQUFHLEVBQWI7O0FBQ0EsT0FBSyxNQUFNQyxJQUFYLElBQW1CRixLQUFuQixFQUEwQjtBQUN4QixRQUFJLENBQUNFLElBQUksQ0FBQ0MsVUFBVixFQUFzQjtBQUNwQjtBQUNEOztBQUNELFVBQU1FLEtBQUssR0FBR0MsS0FBSyxDQUFDQyxJQUFOLENBQVdMLElBQUksQ0FBQ0MsVUFBaEIsQ0FBZDtBQUNBLFVBQU1DLEtBQUssR0FBRyxFQUFkOztBQUNBLFNBQUssTUFBTUksSUFBWCxJQUFtQkgsS0FBbkIsRUFBMEI7QUFDeEJELE1BQUFBLEtBQUssQ0FBQ0ksSUFBSSxDQUFDQyxJQUFOLENBQUwsR0FBbUJELElBQUksQ0FBQ0csS0FBeEI7QUFDRDs7QUFDRFYsSUFBQUEsTUFBTSxDQUFDYyxJQUFQLENBQVlYLEtBQVo7QUFDRDs7QUFDREgsRUFBQUEsTUFBTSxHQUFHQSxNQUFNLENBQUNlLE1BQVAsQ0FBZUMsQ0FBRCxJQUFPLENBQUNBLENBQUMsQ0FBQ1IsSUFBRixJQUFVUSxDQUFDLENBQUNQLEtBQWIsS0FBdUJPLENBQUMsQ0FBQ25CLEdBQXpCLElBQWdDbUIsQ0FBQyxDQUFDbkMsR0FBdkQsQ0FBVDs7QUFDQSxNQUFJbUIsTUFBTSxDQUFDYixNQUFQLEtBQWtCLENBQXRCLEVBQXlCO0FBQ3ZCLFVBQU0sSUFBSUMsbUJBQU9DLGlCQUFYLENBQThCLGNBQWFpQyxVQUFXLGtCQUF0RCxDQUFOO0FBQ0Q7O0FBQ0R0QixFQUFBQSxNQUFNLENBQUN1QixJQUFQLENBQVksQ0FBQ0MsQ0FBRCxFQUFJQyxDQUFKLEtBQVU7QUFDcEIsVUFBTUMsRUFBRSxHQUFHRixDQUFDLENBQUNoQixJQUFGLEtBQVdjLFVBQVgsR0FBd0IsQ0FBQyxDQUF6QixHQUE2QixDQUF4QztBQUNBLFVBQU1LLEVBQUUsR0FBR0YsQ0FBQyxDQUFDakIsSUFBRixLQUFXYyxVQUFYLEdBQXdCLENBQUMsQ0FBekIsR0FBNkIsQ0FBeEM7QUFDQSxXQUFPSSxFQUFFLEdBQUdDLEVBQVo7QUFDRCxHQUpEOztBQUtBLE9BQUssTUFBTXhCLEtBQVgsSUFBb0JILE1BQXBCLEVBQTRCO0FBQzFCLFVBQU00QixJQUFJLEdBQUdoQixNQUFNLENBQUNDLFFBQVAsQ0FBZ0JWLEtBQUssQ0FBQ04sR0FBdEIsRUFBMkIsRUFBM0IsQ0FBYjs7QUFDQSxRQUFJWixxQkFBS21DLHNCQUFMLENBQTRCRSxVQUE1QixFQUF3Q00sSUFBeEMsQ0FBSixFQUFtRDtBQUNqRCxhQUFPO0FBQ0wvQixRQUFBQSxHQUFHLEVBQUUrQixJQURBO0FBRUwvQyxRQUFBQSxHQUFHLEVBQUUrQixNQUFNLENBQUNDLFFBQVAsQ0FBZ0JWLEtBQUssQ0FBQ3RCLEdBQXRCLEVBQTJCLEVBQTNCLENBRkE7QUFHTDJCLFFBQUFBLElBQUksRUFBRWM7QUFIRCxPQUFQO0FBS0Q7QUFDRjs7QUFDRCxRQUFNLElBQUlsQyxtQkFBT0MsaUJBQVgsQ0FBOEIsY0FBYWlDLFVBQVcsa0JBQXRELENBQU47QUFDRCxDQTdDRDs7QUErQ0E1QyxRQUFRLENBQUNtRCx1QkFBVCxHQUFtQyxVQUFVaEQsR0FBVixFQUFlO0FBQ2hELFFBQU1TLFdBQVcsR0FBR0wscUJBQUtNLHFCQUFMLEVBQXBCOztBQUNBLFFBQU1DLEdBQUcsR0FBRyxJQUFJQyxpQkFBSixHQUFVQyxlQUFWLENBQTBCSixXQUExQixDQUFaO0FBQ0EsUUFBTUssS0FBSyxHQUFJLGFBQVlkLEdBQUksNEJBQS9CO0FBQ0EsUUFBTWtCLEtBQUssR0FBRyxvQkFBT1AsR0FBUCxFQUFZRyxLQUFaLENBQWQ7O0FBQ0EsTUFBSSxDQUFDSSxLQUFELElBQVVBLEtBQUssQ0FBQ1osTUFBTixLQUFpQixDQUEvQixFQUFrQztBQUNoQyxVQUFNLElBQUlDLG1CQUFPQyxpQkFBWCxDQUE4QixrQkFBaUJSLEdBQUksa0JBQW5ELENBQU47QUFDRDs7QUFDRCxNQUFJb0IsSUFBSSxHQUFHRixLQUFLLENBQUMsQ0FBRCxDQUFoQjtBQUNBLFFBQU1LLEtBQUssR0FBR0MsS0FBSyxDQUFDQyxJQUFOLENBQVdMLElBQUksQ0FBQ0MsVUFBaEIsQ0FBZDtBQUNBLFFBQU1DLEtBQUssR0FBRyxFQUFkOztBQUNBLE9BQUssTUFBTUksSUFBWCxJQUFtQkgsS0FBbkIsRUFBMEI7QUFDeEJELElBQUFBLEtBQUssQ0FBQ0ksSUFBSSxDQUFDQyxJQUFOLENBQUwsR0FBbUJELElBQUksQ0FBQ0csS0FBeEI7QUFDRDs7QUFDRFQsRUFBQUEsSUFBSSxHQUFHRSxLQUFQOztBQUNBLE1BQUksQ0FBQ0YsSUFBSSxDQUFDTyxJQUFOLElBQWMsQ0FBQ1AsSUFBSSxDQUFDSixHQUFwQixJQUEyQixDQUFDSSxJQUFJLENBQUNwQixHQUFyQyxFQUEwQztBQUN4QyxVQUFNLElBQUlPLG1CQUFPQyxpQkFBWCxDQUE4QixrQkFBaUJSLEdBQUksa0JBQW5ELENBQU47QUFDRDs7QUFDRCxNQUFJLENBQUNJLHFCQUFLbUMsc0JBQUwsQ0FBNEJuQixJQUFJLENBQUNPLElBQWpDLEVBQXVDSSxNQUFNLENBQUNDLFFBQVAsQ0FBZ0JaLElBQUksQ0FBQ0osR0FBckIsRUFBMEIsRUFBMUIsQ0FBdkMsQ0FBTCxFQUE0RTtBQUMxRSxVQUFNLElBQUlULG1CQUFPQyxpQkFBWCxDQUE4QixrQkFBaUJSLEdBQUksa0JBQW5ELENBQU47QUFDRDs7QUFDRCxTQUFPO0FBQ0xnQixJQUFBQSxHQUFHLEVBQUVlLE1BQU0sQ0FBQ0MsUUFBUCxDQUFnQlosSUFBSSxDQUFDSixHQUFyQixFQUEwQixFQUExQixDQURBO0FBRUxoQixJQUFBQSxHQUFHLEVBQUUrQixNQUFNLENBQUNDLFFBQVAsQ0FBZ0JaLElBQUksQ0FBQ3BCLEdBQXJCLEVBQTBCLEVBQTFCLENBRkE7QUFHTDJCLElBQUFBLElBQUksRUFBRVAsSUFBSSxDQUFDTztBQUhOLEdBQVA7QUFLRCxDQTFCRDs7QUE0QkEsU0FBU3NCLFlBQVQsQ0FBdUJ0QixJQUF2QixFQUE2QjtBQUMzQixNQUFJLENBQUNBLElBQUwsRUFBVztBQUNULFdBQU9BLElBQVA7QUFDRDs7QUFDRCxPQUFLLElBQUl1QixDQUFDLEdBQUcsQ0FBYixFQUFnQkEsQ0FBQyxHQUFHdkIsSUFBSSxDQUFDckIsTUFBekIsRUFBaUMsRUFBRTRDLENBQW5DLEVBQXNDO0FBQ3BDLFFBQUl2QixJQUFJLENBQUN1QixDQUFELENBQUosR0FBVSxHQUFWLElBQWlCdkIsSUFBSSxDQUFDdUIsQ0FBRCxDQUFKLEdBQVUsR0FBL0IsRUFBb0M7QUFDbEMsYUFBT3ZCLElBQVA7QUFDRDtBQUNGOztBQUNELFNBQU8sSUFBUDtBQUNEOztBQUVELFNBQVN3QixjQUFULENBQXlCQyxNQUF6QixFQUFpQztBQUMvQixNQUFJLENBQUNBLE1BQUwsRUFBYTtBQUNYLFdBQU9BLE1BQVA7QUFDRDs7QUFDRCxPQUFLLElBQUlGLENBQUMsR0FBRyxDQUFiLEVBQWdCQSxDQUFDLEdBQUdFLE1BQU0sQ0FBQzlDLE1BQTNCLEVBQW1DLEVBQUU0QyxDQUFyQyxFQUF3QztBQUN0QyxRQUFJRSxNQUFNLENBQUNGLENBQUQsQ0FBTixHQUFZLEdBQVosSUFBbUJFLE1BQU0sQ0FBQ0YsQ0FBRCxDQUFOLEdBQVksR0FBbkMsRUFBd0M7QUFDdEMsYUFBTyxJQUFQO0FBQ0Q7QUFDRjs7QUFDRCxTQUFPRSxNQUFQO0FBQ0Q7O0FBRUR2RCxRQUFRLENBQUN3RCxTQUFULEdBQXFCLFNBQVNBLFNBQVQsQ0FBb0IxQixJQUFwQixFQUEwQnlCLE1BQTFCLEVBQWtDO0FBQ3JEQSxFQUFBQSxNQUFNLEdBQUdELGNBQWMsQ0FBQ0MsTUFBRCxDQUF2QjtBQUNBekIsRUFBQUEsSUFBSSxHQUFHc0IsWUFBWSxDQUFDdEIsSUFBRCxDQUFuQjs7QUFDQSxNQUFJQSxJQUFKLEVBQVU7QUFDUixVQUFNMkIsR0FBRyxHQUFHLEtBQUtkLHlCQUFMLENBQStCYixJQUEvQixDQUFaOztBQUNBLFNBQUs1QixJQUFMLEdBQVl1RCxHQUFaO0FBQ0QsR0FIRCxNQUdPLElBQUlGLE1BQUosRUFBWTtBQUNqQixVQUFNRSxHQUFHLEdBQUcsS0FBS04sdUJBQUwsQ0FBNkJJLE1BQTdCLENBQVo7O0FBQ0EsU0FBS3JELElBQUwsR0FBWXVELEdBQVo7QUFDRCxHQUhNLE1BR0E7QUFDTCxVQUFNLElBQUkvQyxtQkFBT2dELFlBQVgsQ0FBd0IsbURBQXhCLENBQU47QUFDRDtBQUNGLENBWkQ7O0FBY0ExRCxRQUFRLENBQUMyRCxhQUFULEdBQXlCLFNBQVNBLGFBQVQsR0FBMEI7QUFDakQsUUFBTUYsR0FBRyxHQUFHLEtBQUt2RCxJQUFqQjs7QUFDQSxNQUFJLENBQUN1RCxHQUFMLEVBQVU7QUFDUixVQUFNLElBQUkvQyxtQkFBT0MsaUJBQVgsQ0FBOEIseUJBQTlCLENBQU47QUFDRDs7QUFDRCxRQUFNO0FBQUNSLElBQUFBO0FBQUQsTUFBUXNELEdBQWQ7QUFDQSxTQUFPbEQscUJBQUtxRCxjQUFMLENBQW9CekQsR0FBcEIsQ0FBUDtBQUNELENBUEQ7O2VBU2VILFEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgYXBpcyBmcm9tICdAc3Rkc3BhL3N0ZHNwYWxpbnV4X3RlbXAvZGlzdC9wcml2YXRlYXBpcyc7XG5pbXBvcnQgc2VsZWN0IGZyb20gJ3hwYXRoLmpzJztcbmltcG9ydCB7IERPTVBhcnNlciBhcyBkb20gfSBmcm9tICd4bWxkb20nO1xuaW1wb3J0IHsgZXJyb3JzIH0gZnJvbSAnQGFwcGl1bS9iYXNlLWRyaXZlcic7XG5cbmNvbnN0IGNvbW1hbmRzID0ge307XG5cbmNvbW1hbmRzLmdldFdpbmRvd0hhbmRsZSA9IGZ1bmN0aW9uIGdldFdpbmRvd0hhbmRsZSAoKSB7XG4gIHJldHVybiB0aGlzLl93aW4/LndpZDtcbn07XG5cbmNvbW1hbmRzLmdldFdpbmRvd0hhbmRsZXMgPSBmdW5jdGlvbiBnZXRXaW5kb3dIYW5kbGVzICgpIHtcbiAgY29uc3QgYXBwTmFtZSA9IHRoaXMuYXBwTmFtZTtcbiAgY29uc3QgcGlkcyA9IGFwaXMuYXBwX3J1bm5pbmcoYXBwTmFtZSk7XG4gIGlmICghcGlkcyB8fCBwaWRzLmxlbmd0aCA9PT0gMCkge1xuICAgIHRocm93IG5ldyBlcnJvcnMuTm9TdWNoV2luZG93RXJyb3IoYGFwcGxpY2F0aW9uICR7YXBwTmFtZX0gaXMgbm90IHJ1bm5pbmdgKTtcbiAgfVxuICBjb25zdCB3aW5IaWVyYWNoeSA9IGFwaXMuYXBwX2dldFdpbmRvd0hpZXJhY2h5KCk7XG4gIGNvbnN0IGRvYyA9IG5ldyBkb20oKS5wYXJzZUZyb21TdHJpbmcod2luSGllcmFjaHkpO1xuICBsZXQgeHBhdGggPSBwaWRzLm1hcCgocGlkKSA9PiBgQHBpZD1cIiR7cGlkfVwiYCkuam9pbignIG9yICcpO1xuICB4cGF0aCA9IGAvLypbJHt4cGF0aH0gYW5kIEBJbnB1dE91dHB1dD1cInRydWVcIl1gO1xuICBjb25zdCBub2RlcyA9IHNlbGVjdChkb2MsIHhwYXRoKTtcbiAgaWYgKCFub2RlcyB8fCBub2Rlcy5sZW5ndGggPT09IDApIHtcbiAgICByZXR1cm4gW107XG4gIH1cbiAgbGV0IF9ub2RlcyA9IFtdO1xuICBmb3IgKGNvbnN0IG5vZGUgb2Ygbm9kZXMpIHtcbiAgICBpZiAoIW5vZGUuYXR0cmlidXRlcykge1xuICAgICAgY29udGludWU7XG4gICAgfVxuICAgIGNvbnN0IF9ub2RlID0ge307XG4gICAgY29uc3QgYXR0cnMgPSBBcnJheS5mcm9tKG5vZGUuYXR0cmlidXRlcyk7XG4gICAgZm9yIChjb25zdCBhdHRyIG9mIGF0dHJzKSB7XG4gICAgICBpZiAoYXR0ci5uYW1lID09PSAnY2xhc3MnKSB7XG4gICAgICAgIF9ub2RlLmNsYXNzID0gYXR0ci52YWx1ZS5zcGxpdCgnICcpO1xuICAgICAgfSBlbHNlIGlmIChhdHRyLm5hbWUgPT09ICduYW1lJykge1xuICAgICAgICBfbm9kZS5uYW1lID0gYXR0ci52YWx1ZTtcbiAgICAgIH0gZWxzZSBpZiAoYXR0ci5uYW1lID09PSAncGlkJykge1xuICAgICAgICBfbm9kZS5waWQgPSBOdW1iZXIucGFyc2VJbnQoYXR0ci52YWx1ZSwgMTApO1xuICAgICAgfSBlbHNlIGlmIChhdHRyLm5hbWUgPT09ICd3aWQnKSB7XG4gICAgICAgIF9ub2RlLndpZCA9IE51bWJlci5wYXJzZUludChhdHRyLnZhbHVlLCAxMCk7XG4gICAgICB9XG4gICAgfVxuICAgIF9ub2Rlcy5wdXNoKF9ub2RlKTtcbiAgfVxuICBfbm9kZXMgPSBfbm9kZXMuZmlsdGVyKChwKSA9PiAocC5jbGFzcyB8fCBwLm5hbWUpICYmIHAucGlkICYmIHAud2lkKTtcbiAgaWYgKF9ub2Rlcy5sZW5ndGggPT09IDApIHtcbiAgICByZXR1cm4gW107XG4gIH1cbiAgX25vZGVzID0gX25vZGVzLm1hcCgocCkgPT4ge1xuICAgIGxldCBfbm9kZSA9IHtwaWQ6IHAucGlkLCB3aWQ6IHAud2lkLCBuYW1lczogW119O1xuICAgIGlmIChwLm5hbWUpIHtcbiAgICAgIF9ub2RlLm5hbWVzLnB1c2gocC5uYW1lKTtcbiAgICB9XG4gICAgaWYgKHAuY2xhc3MpIHtcbiAgICAgIF9ub2RlLm5hbWVzLnB1c2goLi4ucC5jbGFzcyk7XG4gICAgfVxuICAgIHJldHVybiBfbm9kZTtcbiAgfSk7XG4gIGNvbnN0IHdpZHMgPSBbXTtcbiAgZm9yIChjb25zdCBfbm9kZSBvZiBfbm9kZXMpIHtcbiAgICBsZXQgb2sgPSBmYWxzZTtcbiAgICBmb3IgKGNvbnN0IG5hbWUgb2YgX25vZGUubmFtZXMpIHtcbiAgICAgIGlmIChhcGlzLmExMXlfY2hlY2tXaW5kb3dFeGlzdHMobmFtZSwgX25vZGUucGlkKSkge1xuICAgICAgICBvayA9IHRydWU7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAob2spIHtcbiAgICAgIHdpZHMucHVzaChfbm9kZS53aWQpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gd2lkcztcbn07XG5cbmNvbW1hbmRzLl9nZXRXaW5BbmRQaWRfRnJvbVdpbk5hbWUgPSBmdW5jdGlvbiAod2luZG93TmFtZSkge1xuICBjb25zdCBwaWRzID0gYXBpcy5hcHBfcnVubmluZyh0aGlzLmFwcE5hbWUpO1xuICBpZiAoIXBpZHMgfHwgcGlkcy5sZW5ndGggPT09IDApIHtcbiAgICB0aHJvdyBuZXcgZXJyb3JzLk5vU3VjaFdpbmRvd0Vycm9yKGBhcHBsaWNhdGlvbiAke3RoaXMuYXBwTmFtZX0gaXMgbm90IHJ1bm5pbmdgKTtcbiAgfVxuICBjb25zdCB3aW5IaWVyYWNoeSA9IGFwaXMuYXBwX2dldFdpbmRvd0hpZXJhY2h5KCk7XG4gIGNvbnN0IGRvYyA9IG5ldyBkb20oKS5wYXJzZUZyb21TdHJpbmcod2luSGllcmFjaHkpO1xuICBsZXQgeHBhdGggPSBwaWRzLm1hcCgocGlkKSA9PiBgQHBpZD1cIiR7cGlkfVwiYCkuam9pbignIG9yICcpO1xuICB4cGF0aCA9IGAvLypbKCR7eHBhdGh9KSBhbmQgQElucHV0T3V0cHV0PVwidHJ1ZVwiIGFuZCAoQG5hbWU9XCIke3dpbmRvd05hbWV9XCIgb3IgY29udGFpbnMoY29uY2F0KFwiIFwiLCBAY2xhc3MsIFwiIFwiKSwgXCIkeycgJyArIHdpbmRvd05hbWUgKyAnICd9XCIpKV1gO1xuICBjb25zdCBub2RlcyA9IHNlbGVjdChkb2MsIHhwYXRoKTtcbiAgaWYgKCFub2RlcyB8fCBub2Rlcy5sZW5ndGggPT09IDApIHtcbiAgICB0aHJvdyBuZXcgZXJyb3JzLk5vU3VjaFdpbmRvd0Vycm9yKGB0aGUgd2luZG93ICR7d2luZG93TmFtZX0gZG9lc24ndCBwcmVzZW50YCk7XG4gIH1cbiAgbGV0IF9ub2RlcyA9IFtdO1xuICBmb3IgKGNvbnN0IG5vZGUgb2Ygbm9kZXMpIHtcbiAgICBpZiAoIW5vZGUuYXR0cmlidXRlcykge1xuICAgICAgY29udGludWU7XG4gICAgfVxuICAgIGNvbnN0IGF0dHJzID0gQXJyYXkuZnJvbShub2RlLmF0dHJpYnV0ZXMpO1xuICAgIGNvbnN0IF9ub2RlID0ge307XG4gICAgZm9yIChjb25zdCBhdHRyIG9mIGF0dHJzKSB7XG4gICAgICBfbm9kZVthdHRyLm5hbWVdID0gYXR0ci52YWx1ZTtcbiAgICB9XG4gICAgX25vZGVzLnB1c2goX25vZGUpO1xuICB9XG4gIF9ub2RlcyA9IF9ub2Rlcy5maWx0ZXIoKHApID0+IChwLm5hbWUgfHwgcC5jbGFzcykgJiYgcC5waWQgJiYgcC53aWQpO1xuICBpZiAoX25vZGVzLmxlbmd0aCA9PT0gMCkge1xuICAgIHRocm93IG5ldyBlcnJvcnMuTm9TdWNoV2luZG93RXJyb3IoYHRoZSB3aW5kb3cgJHt3aW5kb3dOYW1lfSBkb2Vzbid0IHByZXNlbnRgKTtcbiAgfVxuICBfbm9kZXMuc29ydCgoYSwgYikgPT4ge1xuICAgIGNvbnN0IGF2ID0gYS5uYW1lID09PSB3aW5kb3dOYW1lID8gLTEgOiAxO1xuICAgIGNvbnN0IGJ2ID0gYi5uYW1lID09PSB3aW5kb3dOYW1lID8gLTEgOiAxO1xuICAgIHJldHVybiBhdiAtIGJ2O1xuICB9KTtcbiAgZm9yIChjb25zdCBfbm9kZSBvZiBfbm9kZXMpIHtcbiAgICBjb25zdCBfcGlkID0gTnVtYmVyLnBhcnNlSW50KF9ub2RlLnBpZCwgMTApO1xuICAgIGlmIChhcGlzLmExMXlfY2hlY2tXaW5kb3dFeGlzdHMod2luZG93TmFtZSwgX3BpZCkpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHBpZDogX3BpZCxcbiAgICAgICAgd2lkOiBOdW1iZXIucGFyc2VJbnQoX25vZGUud2lkLCAxMCksXG4gICAgICAgIG5hbWU6IHdpbmRvd05hbWVcbiAgICAgIH07XG4gICAgfVxuICB9XG4gIHRocm93IG5ldyBlcnJvcnMuTm9TdWNoV2luZG93RXJyb3IoYHRoZSB3aW5kb3cgJHt3aW5kb3dOYW1lfSBkb2Vzbid0IHByZXNlbnRgKTtcbn07XG5cbmNvbW1hbmRzLl9nZXRXaW5BbmRQaWRfRnJvbVdpbklkID0gZnVuY3Rpb24gKHdpZCkge1xuICBjb25zdCB3aW5IaWVyYWNoeSA9IGFwaXMuYXBwX2dldFdpbmRvd0hpZXJhY2h5KCk7XG4gIGNvbnN0IGRvYyA9IG5ldyBkb20oKS5wYXJzZUZyb21TdHJpbmcod2luSGllcmFjaHkpO1xuICBjb25zdCB4cGF0aCA9IGAvLypbQHdpZD1cIiR7d2lkfVwiIGFuZCBASW5wdXRPdXRwdXQ9XCJ0cnVlXCJdYDtcbiAgY29uc3Qgbm9kZXMgPSBzZWxlY3QoZG9jLCB4cGF0aCk7XG4gIGlmICghbm9kZXMgfHwgbm9kZXMubGVuZ3RoID09PSAwKSB7XG4gICAgdGhyb3cgbmV3IGVycm9ycy5Ob1N1Y2hXaW5kb3dFcnJvcihgdGhlIHdpbmRvdyB3aWQ9JHt3aWR9IGRvZXNuJ3QgcHJlc2VudGApO1xuICB9XG4gIGxldCBub2RlID0gbm9kZXNbMF07XG4gIGNvbnN0IGF0dHJzID0gQXJyYXkuZnJvbShub2RlLmF0dHJpYnV0ZXMpO1xuICBjb25zdCBfbm9kZSA9IHt9O1xuICBmb3IgKGNvbnN0IGF0dHIgb2YgYXR0cnMpIHtcbiAgICBfbm9kZVthdHRyLm5hbWVdID0gYXR0ci52YWx1ZTtcbiAgfVxuICBub2RlID0gX25vZGU7XG4gIGlmICghbm9kZS5uYW1lIHx8ICFub2RlLnBpZCB8fCAhbm9kZS53aWQpIHtcbiAgICB0aHJvdyBuZXcgZXJyb3JzLk5vU3VjaFdpbmRvd0Vycm9yKGB0aGUgd2luZG93IHdpZD0ke3dpZH0gZG9lc24ndCBwcmVzZW50YCk7XG4gIH1cbiAgaWYgKCFhcGlzLmExMXlfY2hlY2tXaW5kb3dFeGlzdHMobm9kZS5uYW1lLCBOdW1iZXIucGFyc2VJbnQobm9kZS5waWQsIDEwKSkpIHtcbiAgICB0aHJvdyBuZXcgZXJyb3JzLk5vU3VjaFdpbmRvd0Vycm9yKGB0aGUgd2luZG93IHdpZD0ke3dpZH0gZG9lc24ndCBwcmVzZW50YCk7XG4gIH1cbiAgcmV0dXJuIHtcbiAgICBwaWQ6IE51bWJlci5wYXJzZUludChub2RlLnBpZCwgMTApLFxuICAgIHdpZDogTnVtYmVyLnBhcnNlSW50KG5vZGUud2lkLCAxMCksXG4gICAgbmFtZTogbm9kZS5uYW1lXG4gIH07XG59O1xuXG5mdW5jdGlvbiB2YWxpZGF0ZU5hbWUgKG5hbWUpIHtcbiAgaWYgKCFuYW1lKSB7XG4gICAgcmV0dXJuIG5hbWU7XG4gIH1cbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBuYW1lLmxlbmd0aDsgKytpKSB7XG4gICAgaWYgKG5hbWVbaV0gPCAnMCcgfHwgbmFtZVtpXSA+ICc5Jykge1xuICAgICAgcmV0dXJuIG5hbWU7XG4gICAgfVxuICB9XG4gIHJldHVybiBudWxsO1xufVxuXG5mdW5jdGlvbiB2YWxpZGF0ZUhhbmRsZSAoaGFuZGxlKSB7XG4gIGlmICghaGFuZGxlKSB7XG4gICAgcmV0dXJuIGhhbmRsZTtcbiAgfVxuICBmb3IgKGxldCBpID0gMDsgaSA8IGhhbmRsZS5sZW5ndGg7ICsraSkge1xuICAgIGlmIChoYW5kbGVbaV0gPCAnMCcgfHwgaGFuZGxlW2ldID4gJzknKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGhhbmRsZTtcbn1cblxuY29tbWFuZHMuc2V0V2luZG93ID0gZnVuY3Rpb24gc2V0V2luZG93IChuYW1lLCBoYW5kbGUpIHtcbiAgaGFuZGxlID0gdmFsaWRhdGVIYW5kbGUoaGFuZGxlKTtcbiAgbmFtZSA9IHZhbGlkYXRlTmFtZShuYW1lKTtcbiAgaWYgKG5hbWUpIHtcbiAgICBjb25zdCB3aW4gPSB0aGlzLl9nZXRXaW5BbmRQaWRfRnJvbVdpbk5hbWUobmFtZSk7XG4gICAgdGhpcy5fd2luID0gd2luO1xuICB9IGVsc2UgaWYgKGhhbmRsZSkge1xuICAgIGNvbnN0IHdpbiA9IHRoaXMuX2dldFdpbkFuZFBpZF9Gcm9tV2luSWQoaGFuZGxlKTtcbiAgICB0aGlzLl93aW4gPSB3aW47XG4gIH0gZWxzZSB7XG4gICAgdGhyb3cgbmV3IGVycm9ycy5Vbmtub3duRXJyb3IoXCJzZXRXaW5kb3cgYm90aCBuYW1lIGFuZCBoYW5kbGUgZG9uJ3QgaGF2ZSBhIHZhbHVlXCIpO1xuICB9XG59O1xuXG5jb21tYW5kcy5nZXRXaW5kb3dSZWN0ID0gZnVuY3Rpb24gZ2V0V2luZG93UmVjdCAoKSB7XG4gIGNvbnN0IHdpbiA9IHRoaXMuX3dpbjtcbiAgaWYgKCF3aW4pIHtcbiAgICB0aHJvdyBuZXcgZXJyb3JzLk5vU3VjaFdpbmRvd0Vycm9yKGB3aW5kb3cgaXMgbm90IHNwZWNpZmllZGApO1xuICB9XG4gIGNvbnN0IHt3aWR9ID0gd2luO1xuICByZXR1cm4gYXBpcy5hcHBfZ2V0V2luUmVjdCh3aWQpO1xufTtcblxuZXhwb3J0IGRlZmF1bHQgY29tbWFuZHM7Il0sImZpbGUiOiJsaWIvY29tbWFuZHMvd2luZG93LmpzIiwic291cmNlUm9vdCI6Ii4uLy4uLy4uIn0=
