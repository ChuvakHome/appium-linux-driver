"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

require("source-map-support/register");

var _lodash = _interopRequireDefault(require("lodash"));

var _baseDriver = require("@appium/base-driver");

var _logger = _interopRequireDefault(require("../logger"));

var _utils = require("../utils");

var _support = require("@appium/support");

const commands = {};
const EXTENSION_COMMANDS_MAPPING = {
  shell: 'shell',
  getDisplaySize: 'linuxGetDisplaySize',
  mouseMove: 'linuxMouseMove',
  mouseSwipe: 'linuxMouseSwipe',
  rightClick: 'linuxRightClick',
  doubleClick: 'linuxDoubleClick',
  mouseScroll: 'linuxMouseScroll',
  copy: 'linuxCopy',
  getClipboard: 'linuxGetClipboard'
};

commands.execute = async function execute(script, args) {
  if (script.match(/^linux:/)) {
    _logger.default.info(`Executing extension command '${script}'`);

    script = script.replace(/^linux:/, '').trim();
    return await this.executeLinuxCommand(script, _lodash.default.isArray(args) ? args[0] : args);
  }

  throw new _baseDriver.errors.NotImplementedError();
};

commands.executeLinuxCommand = async function executeLinuxCommand(command, opts = {}) {
  if (!_lodash.default.has(EXTENSION_COMMANDS_MAPPING, command)) {
    throw new _baseDriver.errors.UnknownCommandError(`Unknown extension command "${command}". ` + `Only ${_lodash.default.keys(EXTENSION_COMMANDS_MAPPING)} commands are supported.`);
  }

  return await this[EXTENSION_COMMANDS_MAPPING[command]](opts);
};

commands.shell = async function shell(opts = {}) {
  const {
    cmd
  } = opts;

  if (!_support.util.hasValue(cmd)) {
    throw new _baseDriver.errors.UnknownError('parameter cmd is required');
  }

  try {
    const result = await (0, _utils.executeCommand)(cmd);
    return result;
  } catch (err) {
    throw new _baseDriver.errors.UnknownError(err.message);
  }
};

var _default = commands;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9jb21tYW5kcy9leGVjdXRlLmpzIl0sIm5hbWVzIjpbImNvbW1hbmRzIiwiRVhURU5TSU9OX0NPTU1BTkRTX01BUFBJTkciLCJzaGVsbCIsImdldERpc3BsYXlTaXplIiwibW91c2VNb3ZlIiwibW91c2VTd2lwZSIsInJpZ2h0Q2xpY2siLCJkb3VibGVDbGljayIsIm1vdXNlU2Nyb2xsIiwiY29weSIsImdldENsaXBib2FyZCIsImV4ZWN1dGUiLCJzY3JpcHQiLCJhcmdzIiwibWF0Y2giLCJsb2ciLCJpbmZvIiwicmVwbGFjZSIsInRyaW0iLCJleGVjdXRlTGludXhDb21tYW5kIiwiXyIsImlzQXJyYXkiLCJlcnJvcnMiLCJOb3RJbXBsZW1lbnRlZEVycm9yIiwiY29tbWFuZCIsIm9wdHMiLCJoYXMiLCJVbmtub3duQ29tbWFuZEVycm9yIiwia2V5cyIsImNtZCIsInV0aWwiLCJoYXNWYWx1ZSIsIlVua25vd25FcnJvciIsInJlc3VsdCIsImVyciIsIm1lc3NhZ2UiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBRUEsTUFBTUEsUUFBUSxHQUFHLEVBQWpCO0FBRUEsTUFBTUMsMEJBQTBCLEdBQUc7QUFDakNDLEVBQUFBLEtBQUssRUFBRSxPQUQwQjtBQUVqQ0MsRUFBQUEsY0FBYyxFQUFFLHFCQUZpQjtBQUdqQ0MsRUFBQUEsU0FBUyxFQUFFLGdCQUhzQjtBQUlqQ0MsRUFBQUEsVUFBVSxFQUFFLGlCQUpxQjtBQUtqQ0MsRUFBQUEsVUFBVSxFQUFFLGlCQUxxQjtBQU1qQ0MsRUFBQUEsV0FBVyxFQUFFLGtCQU5vQjtBQU9qQ0MsRUFBQUEsV0FBVyxFQUFFLGtCQVBvQjtBQVFqQ0MsRUFBQUEsSUFBSSxFQUFFLFdBUjJCO0FBU2pDQyxFQUFBQSxZQUFZLEVBQUU7QUFUbUIsQ0FBbkM7O0FBWUFWLFFBQVEsQ0FBQ1csT0FBVCxHQUFtQixlQUFlQSxPQUFmLENBQXdCQyxNQUF4QixFQUFnQ0MsSUFBaEMsRUFBc0M7QUFDdkQsTUFBSUQsTUFBTSxDQUFDRSxLQUFQLENBQWEsU0FBYixDQUFKLEVBQTZCO0FBQzNCQyxvQkFBSUMsSUFBSixDQUFVLGdDQUErQkosTUFBTyxHQUFoRDs7QUFDQUEsSUFBQUEsTUFBTSxHQUFHQSxNQUFNLENBQUNLLE9BQVAsQ0FBZSxTQUFmLEVBQTBCLEVBQTFCLEVBQThCQyxJQUE5QixFQUFUO0FBQ0EsV0FBTyxNQUFNLEtBQUtDLG1CQUFMLENBQXlCUCxNQUF6QixFQUFpQ1EsZ0JBQUVDLE9BQUYsQ0FBVVIsSUFBVixJQUFrQkEsSUFBSSxDQUFDLENBQUQsQ0FBdEIsR0FBNEJBLElBQTdELENBQWI7QUFDRDs7QUFDRCxRQUFNLElBQUlTLG1CQUFPQyxtQkFBWCxFQUFOO0FBQ0QsQ0FQRDs7QUFTQXZCLFFBQVEsQ0FBQ21CLG1CQUFULEdBQStCLGVBQWVBLG1CQUFmLENBQW9DSyxPQUFwQyxFQUE2Q0MsSUFBSSxHQUFHLEVBQXBELEVBQXdEO0FBQ3JGLE1BQUksQ0FBQ0wsZ0JBQUVNLEdBQUYsQ0FBTXpCLDBCQUFOLEVBQWtDdUIsT0FBbEMsQ0FBTCxFQUFpRDtBQUMvQyxVQUFNLElBQUlGLG1CQUFPSyxtQkFBWCxDQUFnQyw4QkFBNkJILE9BQVEsS0FBdEMsR0FDbEMsUUFBT0osZ0JBQUVRLElBQUYsQ0FBTzNCLDBCQUFQLENBQW1DLDBCQUR2QyxDQUFOO0FBRUQ7O0FBQ0QsU0FBTyxNQUFNLEtBQUtBLDBCQUEwQixDQUFDdUIsT0FBRCxDQUEvQixFQUEwQ0MsSUFBMUMsQ0FBYjtBQUNELENBTkQ7O0FBUUF6QixRQUFRLENBQUNFLEtBQVQsR0FBaUIsZUFBZUEsS0FBZixDQUFzQnVCLElBQUksR0FBRyxFQUE3QixFQUFpQztBQUNoRCxRQUFNO0FBQUNJLElBQUFBO0FBQUQsTUFBUUosSUFBZDs7QUFDQSxNQUFJLENBQUNLLGNBQUtDLFFBQUwsQ0FBY0YsR0FBZCxDQUFMLEVBQXlCO0FBQ3ZCLFVBQU0sSUFBSVAsbUJBQU9VLFlBQVgsQ0FBd0IsMkJBQXhCLENBQU47QUFDRDs7QUFDRCxNQUFJO0FBQ0YsVUFBTUMsTUFBTSxHQUFHLE1BQU0sMkJBQWVKLEdBQWYsQ0FBckI7QUFDQSxXQUFPSSxNQUFQO0FBQ0QsR0FIRCxDQUdFLE9BQU9DLEdBQVAsRUFBWTtBQUNaLFVBQU0sSUFBSVosbUJBQU9VLFlBQVgsQ0FBd0JFLEdBQUcsQ0FBQ0MsT0FBNUIsQ0FBTjtBQUNEO0FBQ0YsQ0FYRDs7ZUFhZW5DLFEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHsgZXJyb3JzIH0gZnJvbSAnQGFwcGl1bS9iYXNlLWRyaXZlcic7XG5pbXBvcnQgbG9nIGZyb20gJy4uL2xvZ2dlcic7XG5pbXBvcnQgeyBleGVjdXRlQ29tbWFuZCB9IGZyb20gJy4uL3V0aWxzJztcbmltcG9ydCB7IHV0aWwgfSBmcm9tICdAYXBwaXVtL3N1cHBvcnQnO1xuXG5jb25zdCBjb21tYW5kcyA9IHt9O1xuXG5jb25zdCBFWFRFTlNJT05fQ09NTUFORFNfTUFQUElORyA9IHtcbiAgc2hlbGw6ICdzaGVsbCcsXG4gIGdldERpc3BsYXlTaXplOiAnbGludXhHZXREaXNwbGF5U2l6ZScsXG4gIG1vdXNlTW92ZTogJ2xpbnV4TW91c2VNb3ZlJyxcbiAgbW91c2VTd2lwZTogJ2xpbnV4TW91c2VTd2lwZScsXG4gIHJpZ2h0Q2xpY2s6ICdsaW51eFJpZ2h0Q2xpY2snLFxuICBkb3VibGVDbGljazogJ2xpbnV4RG91YmxlQ2xpY2snLFxuICBtb3VzZVNjcm9sbDogJ2xpbnV4TW91c2VTY3JvbGwnLFxuICBjb3B5OiAnbGludXhDb3B5JyxcbiAgZ2V0Q2xpcGJvYXJkOiAnbGludXhHZXRDbGlwYm9hcmQnXG59O1xuXG5jb21tYW5kcy5leGVjdXRlID0gYXN5bmMgZnVuY3Rpb24gZXhlY3V0ZSAoc2NyaXB0LCBhcmdzKSB7XG4gIGlmIChzY3JpcHQubWF0Y2goL15saW51eDovKSkge1xuICAgIGxvZy5pbmZvKGBFeGVjdXRpbmcgZXh0ZW5zaW9uIGNvbW1hbmQgJyR7c2NyaXB0fSdgKTtcbiAgICBzY3JpcHQgPSBzY3JpcHQucmVwbGFjZSgvXmxpbnV4Oi8sICcnKS50cmltKCk7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuZXhlY3V0ZUxpbnV4Q29tbWFuZChzY3JpcHQsIF8uaXNBcnJheShhcmdzKSA/IGFyZ3NbMF0gOiBhcmdzKTtcbiAgfVxuICB0aHJvdyBuZXcgZXJyb3JzLk5vdEltcGxlbWVudGVkRXJyb3IoKTtcbn07XG5cbmNvbW1hbmRzLmV4ZWN1dGVMaW51eENvbW1hbmQgPSBhc3luYyBmdW5jdGlvbiBleGVjdXRlTGludXhDb21tYW5kIChjb21tYW5kLCBvcHRzID0ge30pIHtcbiAgaWYgKCFfLmhhcyhFWFRFTlNJT05fQ09NTUFORFNfTUFQUElORywgY29tbWFuZCkpIHtcbiAgICB0aHJvdyBuZXcgZXJyb3JzLlVua25vd25Db21tYW5kRXJyb3IoYFVua25vd24gZXh0ZW5zaW9uIGNvbW1hbmQgXCIke2NvbW1hbmR9XCIuIGAgK1xuICAgICAgYE9ubHkgJHtfLmtleXMoRVhURU5TSU9OX0NPTU1BTkRTX01BUFBJTkcpfSBjb21tYW5kcyBhcmUgc3VwcG9ydGVkLmApO1xuICB9XG4gIHJldHVybiBhd2FpdCB0aGlzW0VYVEVOU0lPTl9DT01NQU5EU19NQVBQSU5HW2NvbW1hbmRdXShvcHRzKTtcbn07XG5cbmNvbW1hbmRzLnNoZWxsID0gYXN5bmMgZnVuY3Rpb24gc2hlbGwgKG9wdHMgPSB7fSkge1xuICBjb25zdCB7Y21kfSA9IG9wdHM7XG4gIGlmICghdXRpbC5oYXNWYWx1ZShjbWQpKSB7XG4gICAgdGhyb3cgbmV3IGVycm9ycy5Vbmtub3duRXJyb3IoJ3BhcmFtZXRlciBjbWQgaXMgcmVxdWlyZWQnKTtcbiAgfVxuICB0cnkge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGV4ZWN1dGVDb21tYW5kKGNtZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgdGhyb3cgbmV3IGVycm9ycy5Vbmtub3duRXJyb3IoZXJyLm1lc3NhZ2UpO1xuICB9XG59O1xuXG5leHBvcnQgZGVmYXVsdCBjb21tYW5kcztcbiJdLCJmaWxlIjoibGliL2NvbW1hbmRzL2V4ZWN1dGUuanMiLCJzb3VyY2VSb290IjoiLi4vLi4vLi4ifQ==
